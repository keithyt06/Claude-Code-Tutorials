# æ¨¡å— 6: å®‰å…¨æœ€ä½³å®è·µ

> éµå¾ªå®‰å…¨å¼€å‘è§„èŒƒ

## è¾“å…¥éªŒè¯å’Œæ¸…ç†

```javascript
class InputValidator {
  // æ¸…ç† HTML,é˜²æ­¢ XSS
  static sanitizeHTML(input) {
    const map = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#x27;',
      '/': '&#x2F;'
    };
    return input.replace(/[&<>"'/]/g, char => map[char]);
  }
  
  // éªŒè¯é‚®ç®±
  static isValidEmail(email) {
    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return regex.test(email);
  }
  
  // éªŒè¯å¯†ç å¼ºåº¦
  static isStrongPassword(password) {
    // è‡³å°‘8ä½,åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
    const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
    return regex.test(password);
  }
  
  // é˜²æ­¢ SQL æ³¨å…¥
  static containsSQLInjection(input) {
    const sqlPatterns = [
      /(\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE)\b)/i,
      /(--|\#|\/\*|\*\/)/
    ];
    return sqlPatterns.some(pattern => pattern.test(input));
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const username = InputValidator.sanitizeHTML(userInput.username);
const validation = InputValidator.validate(username, {
  required: true,
  minLength: 3,
  maxLength: 20
});
```

## å®‰å…¨å­˜å‚¨æ•æ„Ÿä¿¡æ¯

```javascript
class SecureStorage {
  constructor() {
    this.memoryStorage = new Map();
  }
  
  // æ•æ„Ÿä¿¡æ¯å­˜å†…å­˜
  setSecure(key, value) {
    this.memoryStorage.set(key, value);
  }
  
  getSecure(key) {
    return this.memoryStorage.get(key);
  }
  
  // éæ•æ„Ÿä¿¡æ¯å¯ç”¨ localStorage (åŠ å¯†)
  setLocal(key, value) {
    const encrypted = this.encrypt(JSON.stringify(value));
    localStorage.setItem(key, encrypted);
  }
  
  getLocal(key) {
    const encrypted = localStorage.getItem(key);
    if (!encrypted) return null;
    return JSON.parse(this.decrypt(encrypted));
  }
}

// âœ… æ­£ç¡®åšæ³•
storage.setSecure('auth_token', token);  // ä»¤ç‰Œå­˜å†…å­˜
storage.setLocal('preferences', { theme: 'dark' });  // åå¥½è®¾ç½®åŠ å¯†å­˜å‚¨

// âŒ é”™è¯¯åšæ³•
localStorage.setItem('password', password);  // æ°¸è¿œä¸è¦å­˜å¯†ç 
localStorage.setItem('credit_card', cardNumber);  // ä¸è¦å­˜æ•æ„Ÿä¿¡æ¯
```

## CSP é…ç½®

```html
<!-- HTML ä¸­é…ç½® -->
<meta http-equiv="Content-Security-Policy"
      content="default-src 'self';
               script-src 'self' https://trusted-cdn.com;
               style-src 'self' 'unsafe-inline';
               img-src 'self' data: https:;">
```

```javascript
// Express ä¸­é…ç½®
const helmet = require('helmet');

app.use(helmet.contentSecurityPolicy({
  directives: {
    defaultSrc: ["'self'"],
    scriptSrc: ["'self'", "https://trusted-cdn.com"],
    styleSrc: ["'self'", "'unsafe-inline'"],
    imgSrc: ["'self'", "data:", "https:"]
  }
}));
```

## å…³é”®è¦ç‚¹

1. **è¾“å…¥éªŒè¯** - æ°¸è¿œä¸è¦ä¿¡ä»»ç”¨æˆ·è¾“å…¥
2. **è¾“å‡ºç¼–ç ** - é˜²æ­¢ XSS æ”»å‡»
3. **å®‰å…¨å­˜å‚¨** - æ•æ„Ÿæ•°æ®ä¸å­˜ localStorage
4. **CSP** - é…ç½®å†…å®¹å®‰å…¨ç­–ç•¥
5. **HTTPS** - å§‹ç»ˆä½¿ç”¨åŠ å¯†ä¼ è¾“

## è¯¾ç¨‹æ€»ç»“

é€šè¿‡æœ¬è¯¾ç¨‹,ä½ å­¦åˆ°äº†:
- ç¼–å†™é«˜è´¨é‡æç¤ºè¯
- è¿›è¡Œç³»ç»ŸåŒ–ä»£ç å®¡æŸ¥
- ä½¿ç”¨é«˜æ•ˆè°ƒè¯•æ–¹æ³•
- åº”ç”¨è®¾è®¡æ¨¡å¼
- å®ç°é”™è¯¯å¤„ç†
- éµå¾ªå®‰å…¨æœ€ä½³å®è·µ

ç»§ç»­å®è·µè¿™äº›æŠ€å·§,ä½ çš„å¼€å‘èƒ½åŠ›å°†å¤§å¹…æå‡!

ğŸ‘‰ ä¸‹ä¸€è¯¾: [ç¬¬å…«è¯¾: é«˜çº§åº”ç”¨](../08-é«˜çº§åº”ç”¨.md)
