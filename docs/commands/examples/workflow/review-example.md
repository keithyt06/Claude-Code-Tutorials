# `/review` å‘½ä»¤ç¤ºä¾‹

## æ¦‚è¿°
`/review` å‘½ä»¤è¦æ±‚ Claude å®¡æŸ¥æ‚¨çš„ä»£ç ï¼Œå¯»æ‰¾æ½œåœ¨çš„æ”¹è¿›ã€bugã€å®‰å…¨é—®é¢˜æˆ–æœ€ä½³å®è·µè¿è§„ã€‚

## ä½•æ—¶ä½¿ç”¨
- Commit ä»£ç å‰
- å®ŒæˆåŠŸèƒ½å
- é‡æ„æ—¶
- ä»£ç å®¡æŸ¥å‰
- å­¦ä¹ æœ€ä½³å®è·µæ—¶

## ç¤ºä¾‹ç”¨æ³•

### åŸºæœ¬ä»£ç å®¡æŸ¥

```
User: /review

Claude Code: æˆ‘å°†å®¡æŸ¥æœ€è¿‘çš„æ›´æ”¹ã€‚

æ­£åœ¨åˆ†æï¼š
- src/api/users.ts (å·²ä¿®æ”¹)
- src/components/UserForm.tsx (æ–°)
- tests/users.test.ts (å·²ä¿®æ”¹)

## å®¡æŸ¥æ€»ç»“

### âœ… ä¼˜ç‚¹
- API è°ƒç”¨ä¸­çš„è‰¯å¥½é”™è¯¯å¤„ç†
- å…¨é¢çš„æµ‹è¯•è¦†ç›–ç‡
- æ¸…æ™°çš„ç»„ä»¶ç»“æ„

### âš ï¸ å‘ç°çš„é—®é¢˜

**é«˜ä¼˜å…ˆçº§ï¼š**
1. src/api/users.ts:45 ä¸­çš„ SQL æ³¨å…¥æ¼æ´
   - åœ¨ SQL æŸ¥è¯¢ä¸­ä½¿ç”¨å­—ç¬¦ä¸²æ’å€¼
   - å»ºè®®ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢

**ä¸­ä¼˜å…ˆçº§ï¼š**
2. UserForm.tsx:23 ä¸­ç¼ºå°‘è¾“å…¥éªŒè¯
   - æœªéªŒè¯é‚®ç®±æ ¼å¼
   - å»ºè®®ï¼šæ·»åŠ éªŒè¯åº“ï¼ˆZodï¼‰

3. useEffect ä¸­æ½œåœ¨çš„å†…å­˜æ³„æ¼ (UserForm.tsx:67)
   - ç¼ºå°‘æ¸…ç†å‡½æ•°
   - å»ºè®®ï¼šè¿”å›æ¸…ç†å‡½æ•°

**ä½ä¼˜å…ˆçº§ï¼š**
4. ä¸ä¸€è‡´çš„å‘½åï¼šgetUserData vs fetchUser
   - å»ºè®®ï¼šæ ‡å‡†åŒ–ä¸ºä¸€ç§æ¨¡å¼

æ‚¨å¸Œæœ›æˆ‘ä¿®å¤è¿™äº›é—®é¢˜å—ï¼Ÿ
```

## å®¡æŸ¥ç±»å‹

### 1. å®Œæ•´é¡¹ç›®å®¡æŸ¥

```
User: /review all

Claude Code: æ­£åœ¨è¿›è¡Œå…¨é¢é¡¹ç›®å®¡æŸ¥...

å®¡æŸ¥ä¸­ï¼š
- 45 ä¸ª TypeScript æ–‡ä»¶
- 23 ä¸ªæµ‹è¯•æ–‡ä»¶
- 12 ä¸ªé…ç½®æ–‡ä»¶

[éšåæ˜¯è¯¦ç»†æŠ¥å‘Š]
```

### 2. ç‰¹å®šæ–‡ä»¶å®¡æŸ¥

```
User: /review src/auth/login.ts

Claude Code: æ­£åœ¨å®¡æŸ¥ src/auth/login.ts

## å®‰å…¨é—®é¢˜
1. ç¬¬ 34 è¡Œï¼šå¯†ç ä»¥æ˜æ–‡å­˜å‚¨
2. ç¬¬ 67 è¡Œï¼šJWT secret ç¡¬ç¼–ç 
3. ç¬¬ 89 è¡Œï¼šæ— é€Ÿç‡é™åˆ¶

## æœ€ä½³å®è·µ
1. ä½¿ç”¨ bcrypt è¿›è¡Œå¯†ç å“ˆå¸Œ
2. å°† secrets ç§»è‡³ç¯å¢ƒå˜é‡
3. å®ç°é€Ÿç‡é™åˆ¶ middleware
```

### 3. æœ€è¿‘æ›´æ”¹å®¡æŸ¥

```
User: /review recent

Claude Code: æ­£åœ¨å®¡æŸ¥æœª commit çš„æ›´æ”¹...

å·²ä¿®æ”¹æ–‡ä»¶ (3)ï¼š
- src/api/posts.ts
- src/components/PostCard.tsx
- tests/posts.test.ts

## å®¡æŸ¥
æ‰€æœ‰æ›´æ”¹çœ‹èµ·æ¥ä¸é”™ï¼
- æµ‹è¯•è¦†ç›–æ–°åŠŸèƒ½
- é”™è¯¯å¤„ç†æ­£ç¡®
- TypeScript ç±»å‹æ­£ç¡®

å‡†å¤‡å¥½ commitã€‚
```

## å®¡æŸ¥ç±»åˆ«

### å®‰å…¨å®¡æŸ¥

```
User: /review --focus security

Claude Code: å®‰å…¨é‡ç‚¹å®¡æŸ¥...

ğŸ”´ ä¸¥é‡é—®é¢˜ï¼š
1. XSS æ¼æ´ï¼šæœªè½¬ä¹‰çš„ç”¨æˆ·è¾“å…¥ (PostCard.tsx:45)
   ```tsx
   // å½“å‰
   <div innerHTML={post.content} />

   // å»ºè®®
   <div>{sanitize(post.content)}</div>
   ```

2. è¡¨å•æäº¤ç¼ºå°‘ CSRF token

ğŸŸ¡ è­¦å‘Šï¼š
1. ä»£ç ä¸­çš„ API keysï¼ˆåº”åœ¨ env vars ä¸­ï¼‰
2. å¼±å¯†ç è¦æ±‚

âœ… å‘ç°çš„è‰¯å¥½å®è·µï¼š
- å¼ºåˆ¶ HTTPS
- å¤§å¤šæ•°åœ°æ–¹çš„è¾“å…¥æ¸…ç†
- JWT tokens æ­£ç¡®éªŒè¯
```

### æ€§èƒ½å®¡æŸ¥

```
User: /review --focus performance

Claude Code: æ€§èƒ½å®¡æŸ¥...

âš¡ æ€§èƒ½é—®é¢˜ï¼š

1. ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ (Dashboard.tsx)
   - æ¯æ¬¡çŠ¶æ€æ›´æ”¹éƒ½è§¦å‘å®Œå…¨é‡æ–°æ¸²æŸ“
   - ä¿®å¤ï¼šä½¿ç”¨ React.memo å’Œ useMemo

2. å¤§ bundle å¤§å°
   - Moment.js æ·»åŠ  300KB
   - å»ºè®®ï¼šåˆ‡æ¢åˆ° day.js (2KB)

3. æ— ä»£ç åˆ†å‰²
   - æ‰€æœ‰è·¯ç”±é¢„å…ˆåŠ è½½
   - ä¿®å¤ï¼šå¯¹åŸºäºè·¯ç”±çš„åˆ†å‰²ä½¿ç”¨ React.lazy

4. N+1 æŸ¥è¯¢é—®é¢˜ (api/users.ts:34)
   - ä¸ºæ¯ä¸ªç”¨æˆ·çš„å¸–å­å•ç‹¬æŸ¥è¯¢
   - ä¿®å¤ï¼šä½¿ç”¨ JOIN æˆ–åœ¨åˆå§‹æŸ¥è¯¢ä¸­åŒ…å«
```

### ä»£ç è´¨é‡å®¡æŸ¥

```
User: /review --focus quality

Claude Code: ä»£ç è´¨é‡å®¡æŸ¥...

## å¤æ‚åº¦
- getCognitoUser(): åœˆå¤æ‚åº¦ 15 (é«˜)
  - å»ºè®®ï¼šæ‹†åˆ†ä¸ºæ›´å°çš„å‡½æ•°

## é‡å¤
- å‘ç° 3 ä¸ªç±»ä¼¼é”™è¯¯å¤„ç†çš„å®ä¾‹
  - å»ºè®®ï¼šåˆ›å»ºå¯é‡ç”¨çš„ errorHandler å·¥å…·

## å‘½å
- ä¸ä¸€è‡´ï¼šgetUserInfo, fetch_user, getUser
  - å»ºè®®ï¼šæ ‡å‡†åŒ–ä¸º camelCase

## æ–‡æ¡£
- 15 ä¸ªå‡½æ•°ç¼ºå°‘ JSDoc æ³¨é‡Š
- å¤æ‚ç®—æ³•æœªè§£é‡Š
```

## å®é™…ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šPre-Commit å®¡æŸ¥

```
User: æˆ‘å³å°† commit è¿™äº›è®¤è¯æ›´æ”¹

User: /review

Claude Code: Pre-commit å®¡æŸ¥...

## åº”è¯¥ä¿®å¤çš„é—®é¢˜ï¼š
1. **å®‰å…¨**ï¼šå¯†ç è®°å½•åœ¨æ§åˆ¶å° (auth.ts:23)
2. **Bug**ï¼štoken åˆ·æ–°ä¸­çš„ç«äº‰æ¡ä»¶ (auth.ts:145)

## éé˜»å¡é—®é¢˜ï¼š
3. ç™»å½•å¤±è´¥ç¼ºå°‘é”™è¯¯æ¶ˆæ¯
4. æµ‹è¯•è¦†ç›–ç‡å¯ä»¥æ”¹è¿› (70% â†’ 80%)

**å»ºè®®**ï¼šCommit å‰ä¿®å¤é—®é¢˜ #1 å’Œ #2ã€‚

User: è¯·ä¿®å¤é—®é¢˜ 1 å’Œ 2

Claude Code: [ä¿®å¤é—®é¢˜]

æ‰€æœ‰å…³é”®é—®é¢˜å·²è§£å†³ã€‚ç°åœ¨å¯ä»¥å®‰å…¨ commitã€‚
```

### ç¤ºä¾‹ 2ï¼šä»å®¡æŸ¥ä¸­å­¦ä¹ 

```
User: /review

Claude Code: å‘ç°å‡ ä¸ªé—®é¢˜...

User: ä½ èƒ½è§£é‡Šä¸ºä»€ä¹ˆ #3 æ˜¯ä¸ªé—®é¢˜å—ï¼Ÿ

Claude Code: é—®é¢˜ #3 å…³äº useEffect ä¾èµ–æ•°ç»„ï¼š

```tsx
// å½“å‰ä»£ç 
useEffect(() => {
  fetchData(userId);
}, []); // userId ä¸åœ¨ä¾èµ–ä¸­ï¼
```

é—®é¢˜ï¼šå¦‚æœ userId æ”¹å˜ï¼ŒfetchData ä¸ä¼šå†æ¬¡è°ƒç”¨ã€‚
æ‚¨å°†ä¸ºé”™è¯¯çš„ç”¨æˆ·æ˜¾ç¤ºé™ˆæ—§æ•°æ®ã€‚

ä¿®å¤ï¼š
```tsx
useEffect(() => {
  fetchData(userId);
}, [userId]); // ç°åœ¨å½“ userId æ”¹å˜æ—¶é‡æ–°è¿è¡Œ
```

è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„ React é™·é˜±ã€‚ESLint è§„åˆ™
'exhaustive-deps' å¯ä»¥è‡ªåŠ¨æ•è·è¿™äº›ã€‚
```

### ç¤ºä¾‹ 3ï¼šå¢é‡æ”¹è¿›

```
User: /review

Claude Code: å‘ç° 12 ä¸ªé—®é¢˜ (3 é«˜ï¼Œ5 ä¸­ï¼Œ4 ä½)

User: è®©æˆ‘ä»¬å…ˆä¿®å¤é«˜ä¼˜å…ˆçº§é—®é¢˜

Claude Code: ä¿®å¤é«˜ä¼˜å…ˆçº§é—®é¢˜ï¼š
1. SQL æ³¨å…¥ â†’ å‚æ•°åŒ–æŸ¥è¯¢
2. XSS æ¼æ´ â†’ è¾“å…¥æ¸…ç†
3. å†…å­˜æ³„æ¼ â†’ æ¸…ç†å‡½æ•°

[è¿›è¡Œä¿®å¤]

é«˜ä¼˜å…ˆçº§é—®é¢˜å·²è§£å†³ã€‚

ä¸­ä¼˜å…ˆçº§é—®é¢˜ä»ç„¶å­˜åœ¨ï¼š
- è¾“å…¥éªŒè¯æ”¹è¿›
- é”™è¯¯æ¶ˆæ¯æ¸…æ™°åº¦
- ä»£ç é‡å¤

æ‚¨ç°åœ¨æƒ³å¤„ç†è¿™äº›å—ï¼Ÿ
```

## è‡ªåŠ¨å®¡æŸ¥è§¦å‘å™¨

### ä¿å­˜æ—¶ Hook

```
.claude/hooks/post-file-change.sh:
#!/bin/bash
claude review $FILE
```

### Pre-Commit Hook

```
.git/hooks/pre-commit:
#!/bin/bash
claude review recent --block-on-critical
```

### CI é›†æˆ

```yaml
# .github/workflows/claude-review.yml
name: Claude Code Review
on: [pull_request]
jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Claude Review
        run: claude review --format=github-annotations
```

## å®¡æŸ¥é…ç½®

### è‡ªå®šä¹‰å®¡æŸ¥è§„åˆ™

```
.claude/review-rules.json:
{
  "security": {
    "level": "strict",
    "block": ["eval", "dangerouslySetInnerHTML"],
    "warn": ["console.log in production"]
  },
  "performance": {
    "maxBundleSize": "500KB",
    "maxComplexity": 10
  },
  "style": {
    "enforce": "airbnb",
    "maxLineLength": 100
  }
}
```

## å®¡æŸ¥æŠ¥å‘Š

### Markdown æŠ¥å‘Š

```
User: /review --output report.md

Claude Code: å®¡æŸ¥å®Œæˆã€‚å·²ä¿å­˜åˆ° report.md

# ä»£ç å®¡æŸ¥æŠ¥å‘Š
æ—¥æœŸï¼š2025-01-08
å®¡æŸ¥æ–‡ä»¶ï¼š23

## æ€»ç»“
- ä¸¥é‡ï¼š2
- é«˜ï¼š5
- ä¸­ï¼š8
- ä½ï¼š12

[è¯¦ç»†å‘ç°...]
```

### JSON æŠ¥å‘Š

```
User: /review --output report.json

{
  "date": "2025-01-08",
  "files": 23,
  "issues": [
    {
      "severity": "critical",
      "file": "src/auth.ts",
      "line": 45,
      "message": "SQL æ³¨å…¥æ¼æ´",
      "recommendation": "ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢"
    }
  ]
}
```

## æœ€ä½³å®è·µ

### 1. æ—©æœŸå’Œé¢‘ç¹å®¡æŸ¥
```
- Commits å‰
- å®ŒæˆåŠŸèƒ½å
- é‡æ„æœŸé—´
- å‘å¸ƒå‰
```

### 2. é‡ç‚¹å®¡æŸ¥
```
ä½¿ç”¨ç‰¹å®šå®¡æŸ¥ç±»å‹ï¼š
/review --focus security (éƒ¨ç½²å‰)
/review --focus performance (åŠŸèƒ½å®Œæˆå)
/review --focus quality (é‡æ„æœŸé—´)
```

### 3. å¯¹å‘ç°é‡‡å–è¡ŒåŠ¨
```
- ç«‹å³ä¿®å¤ä¸¥é‡/é«˜ä¼˜å…ˆçº§
- å®‰æ’ä¸­ç­‰é—®é¢˜
- è€ƒè™‘ä½ä¼˜å…ˆçº§é—®é¢˜ï¼ˆæŠ€æœ¯å€ºï¼‰
```

### 4. ä»å®¡æŸ¥ä¸­å­¦ä¹ 
```
User: ä¸ºä»€ä¹ˆè¿™æ˜¯ä¸ªé—®é¢˜ï¼Ÿ
Claude Code: [è§£é‡Šé—®é¢˜å’Œæœ€ä½³å®è·µ]
```

## æç¤º
- æ¯æ¬¡ commit å‰è¿è¡Œ `/review`
- é¦–å…ˆå…³æ³¨ä¸¥é‡/é«˜ä¼˜å…ˆçº§é—®é¢˜
- ä½¿ç”¨å®¡æŸ¥å­¦ä¹ æœ€ä½³å®è·µ
- ä¸ºé¡¹ç›®é…ç½®è‡ªå®šä¹‰è§„åˆ™
- ä½¿ç”¨ hooks è‡ªåŠ¨åŒ–å®¡æŸ¥
- å¯¼å‡ºæŠ¥å‘Šç”¨äºæ–‡æ¡£

## ç›¸å…³å‘½ä»¤
- `/todos` - è·Ÿè¸ªå®¡æŸ¥ä¸­å‘ç°çš„é—®é¢˜
- `/export` - ä¿å­˜å®¡æŸ¥æŠ¥å‘Š
- `/config` - é…ç½®å®¡æŸ¥è®¾ç½®
