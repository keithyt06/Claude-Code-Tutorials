# `/cost` 命令示例

## 概述
`/cost` 命令显示详细的 token 使用统计和相关成本，帮助您跟踪和优化 API 使用。

## 何时使用
- 监控 token 消耗
- 估算长会话的成本
- 优化昂贵的操作
- 项目预算编制
- 了解定价
- 比较 model 成本
- 会话结束审查

## 示例用法

### 场景 1：基本成本概览

```
User: /cost

Claude Code: Token 使用 & 成本摘要
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Model: Claude Sonnet 4.5
会话持续时间：1h 23m

Token 使用：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

输入 Tokens:  28,456  ($0.085)
输出 Tokens: 12,345  ($0.370)
─────────────────────────────────────
总计:         40,801  ($0.455)

定价（每 1M tokens）：
├─ 输入:  $3.00 / 1M tokens
└─ 输出: $30.00 / 1M tokens

每条消息平均：
├─ 用户消息: 1,185 tokens/msg
└─ Assistant: 1,372 tokens/msg

成本分解：
├─ 对话: $0.312 (68.6%)
├─ 工具使用:   $0.098 (21.5%)
└─ 文件读取:   $0.045 (9.9%)

状态：🟢 正常范围内
```

### 场景 2：详细成本分解

```
User: /cost --detailed

Claude Code: 详细成本分析
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

会话：2025-01-08 13:00 - 14:23 (1h 23m)
Model: Claude Sonnet 4.5

按类别的 Token 使用：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

对话：
├─ 输入:  18,234 tokens  ($0.055)
├─ 输出:  9,876 tokens  ($0.296)
└─ 总计:  28,110 tokens  ($0.351) [68.9%]

工具使用：
├─ 读取文件:      4,567 tokens  ($0.014) 输入
├─ Grep 搜索:   1,234 tokens  ($0.004) 输入
├─ Bash 命令:     456 tokens  ($0.001) 输入
├─ 工具响应:  2,345 tokens  ($0.070) 输出
└─ 总计:           8,602 tokens  ($0.089) [21.1%]

代码 Context:
├─ 文件内容:   3,456 tokens  ($0.010) 输入
├─ 代码分析:     567 tokens  ($0.017) 输出
└─ 总计:           4,023 tokens  ($0.027) [9.9%]

Memory (CLAUDE.md):
├─ 已加载:            123 tokens  ($0.000) 输入
└─ 总计:             123 tokens  ($0.000) [0.3%]

总成本: $0.455

每个活动的成本：
┌────────────────────────────┬──────────┬─────────┐
│ 活动                       │ Tokens   │ 成本    │
├────────────────────────────┼──────────┼─────────┤
│ 代码重构                   │ 8,234    │ $0.145  │
│ 编写测试                   │ 6,789    │ $0.112  │
│ 文档编写                   │ 4,567    │ $0.076  │
│ Bug 修复                   │ 3,456    │ $0.058  │
│ 代码审查                   │ 2,345    │ $0.039  │
│ 其他                       │ 1,234    │ $0.025  │
└────────────────────────────┴──────────┴─────────┘
```

### 场景 3：成本比较

```
User: /cost --compare

Claude Code: 跨 Models 的成本比较
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

您当前的会话 (Sonnet 4.5):
Tokens: 40,801
成本: $0.455

如果使用其他 models:

Claude Opus:
├─ 输入:  28,456 tokens × $15.00/1M = $0.427
├─ 输出: 12,345 tokens × $75.00/1M = $0.926
└─ 总计:  40,801 tokens = $1.353
   差异: +$0.898 (297% 更贵)

Claude Haiku:
├─ 输入:  28,456 tokens × $0.25/1M = $0.007
├─ 输出: 12,345 tokens × $1.25/1M = $0.015
└─ 总计:  40,801 tokens = $0.022
   差异: -$0.433 (95% 更便宜)

Claude Sonnet 4.5 (当前):
├─ 输入:  28,456 tokens × $3.00/1M = $0.085
├─ 输出: 12,345 tokens × $30.00/1M = $0.370
└─ 总计:  40,801 tokens = $0.455
   ✓ 当前选择

建议：
- Opus: 仅用于关键/复杂任务
- Sonnet: 良好平衡（当前选择）✓
- Haiku: 用于简单/重复任务
```

## 成本跟踪

### 会话成本

```
User: /cost --session

Claude Code: 会话成本跟踪
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

当前会话：
开始时间：13:00
持续时间：1h 23m
成本: $0.455

随时间的成本：
13:00 - 13:15  $0.045  ▓▓░░░░░░░░
13:15 - 13:30  $0.089  ▓▓▓▓░░░░░░
13:30 - 13:45  $0.156  ▓▓▓▓▓▓▓░░░
13:45 - 14:00  $0.098  ▓▓▓▓░░░░░░
14:00 - 14:15  $0.045  ▓▓░░░░░░░░
14:15 - 14:23  $0.022  ▓░░░░░░░░░

平均：$0.033/小时
高峰期：13:30-13:45 ($0.156)

高峰期活动：
- 大文件重构
- 生成了 45 个单元测试
- 全面代码审查
```

### 每日/每周/每月成本

```
User: /cost --history

Claude Code: 成本历史
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

今天 (2025-01-08):
会话：3
Tokens: 142,345
成本: $1.87
─────────────────────────────────────

本周：
会话：18
Tokens: 1,234,567
成本: $15.34
平均：$2.19/天
─────────────────────────────────────

本月：
会话：67
Tokens: 4,567,890
成本: $58.92
平均：$2.62/天

预计月度成本：$78.60

按天的成本：
Mon: $2.34  ▓▓▓▓▓▓░░░░
Tue: $3.45  ▓▓▓▓▓▓▓▓░░
Wed: $2.12  ▓▓▓▓▓░░░░░
Thu: $2.89  ▓▓▓▓▓▓▓░░░
Fri: $4.23  ▓▓▓▓▓▓▓▓▓▓
Sat: $0.45  ▓░░░░░░░░░
Sun: $0.86  ▓▓░░░░░░░░

预算：$100/月
已使用：$58.92 (58.9%)
剩余：$41.08
```

## 成本优化

### 优化建议

```
User: /cost --optimize

Claude Code: 成本优化分析
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

当前会话成本: $0.455

识别出的潜在节省：

1. 更频繁使用 /compact
   当前：Context 增长到 142k tokens
   最佳：在 100k tokens 时压缩
   潜在节省：$0.12 (26%)

2. 简单任务切换到 Haiku
   检测到简单任务：8 条消息 (19.6%)
   当前成本：$0.089
   Haiku 成本：$0.004
   潜在节省：$0.085 (95%)

3. 减少文件 context
   加载的文件：23 个文件 (45k tokens)
   使用的文件：8 个文件
   未使用：15 个文件 (28k tokens)
   潜在节省：$0.084 (18%)

4. 批量处理类似操作
   单独文件读取：15 次读取
   可以批量：3 批
   潜在节省：$0.012 (2.6%)

总潜在节省：$0.301 (66%)
优化后成本：$0.154

应用优化：
[1] 启用自动压缩
[2] 建议 model 切换
[3] 自动删除未使用的文件
[4] 以上全部

User: 4

✓ 优化已启用
您的下次会话将便宜约 66%！
```

### 实时成本警报

```
User: /cost --alert 5

Claude Code: 成本警报已配置
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

警报阈值：$5.00
当前会话：$0.455

您将在以下情况下收到通知：
- 会话成本达到 $5.00
- 每日成本达到 $5.00
- 检测到异常支出

警报类型：
[✓] 对话内警告
[✓] 桌面通知
[✓] 昂贵操作前

[稍后，接近限制时]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️  成本警报：接近每日限制

每日成本：$4.78 / $5.00 (95.6%)
当前会话：$2.34

剩余预算：$0.22
估计剩余消息：约 3-5 条

建议：
- 完成当前任务
- 明天重新开始会话
- 增加预算：/cost --budget 10
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 成本分析

### 每条消息的成本

```
User: /cost --messages

Claude Code: 每条消息的成本
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

对话时间线：

消息 #1 (13:05)
User: "帮我重构认证代码"
Tokens: 2,456 → 成本: $0.078
▓▓▓▓▓▓▓▓░░

消息 #2 (13:07)
Assistant: [重构解释和代码]
Tokens: 8,234 → 成本: $0.247
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░

消息 #3 (13:12)
User: "为此添加单元测试"
Tokens: 1,234 → 成本: $0.037
▓▓▓▓░░░░░░

消息 #4 (13:15)
Assistant: [测试实现]
Tokens: 6,789 → 成本: $0.204
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░

[... 所有消息继续 ...]

最昂贵的消息：
1. 消息 #2: $0.247 (重构代码)
2. 消息 #4: $0.204 (编写测试)
3. 消息 #8: $0.156 (代码审查)

每条消息的平均成本：
- 用户: $0.042/消息
- Assistant: $0.189/消息
```

### 按任务类型的成本

```
User: /cost --by-task

Claude Code: 按任务类型的成本
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

任务类别：

代码编写：$0.198 (43.5%)
├─ 重构: $0.089
├─ 新功能: $0.067
└─ Bug 修复: $0.042
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

测试：$0.112 (24.6%)
├─ 单元测试: $0.078
├─ 集成测试: $0.023
└─ 测试审查: $0.011
▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

文档编写：$0.076 (16.7%)
├─ 代码注释: $0.045
├─ README 更新: $0.021
└─ API 文档: $0.010
▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

代码审查：$0.039 (8.6%)
▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

其他：$0.030 (6.6%)
▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

最具成本效益：
✓ Bug 修复: $0.014/次修复
✓ 代码注释: $0.003/函数

最昂贵：
⚠️  新功能: $0.022/功能
⚠️  重构: $0.018/文件
```

## 预算管理

### 设置预算

```
User: /cost --budget 100

Claude Code: 预算配置
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

月度预算：$100.00

当前使用：
本月：$58.92 (58.9%)
剩余：$41.08
剩余天数：23

预计月底：$78.60

预算状态：🟢 正常

每日限额：
分配：$3.33/天
当前平均：$2.62/天
状态：低于预算 ✓

已配置的警报：
- 80% 警告: $80.00
- 90% 警告: $90.00
- 100% 限制: $100.00

跟踪使用：/cost --budget-status
```

### 预算状态

```
User: /cost --budget-status

Claude Code: 预算状态
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

月度预算：$100.00

本月使用：
$58.92 / $100.00 (58.9%)

▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░

已过天数：8 / 31 (25.8%)
此时预期使用：$25.81
实际使用：$58.92
状态：超过进度 $33.11

预测：
按当前速率：$228.45/月
预算缺口：-$128.45

建议：
⚠️  支出速度超过预算允许

选项：
[1] 减少使用（目标：$2.17/天）
[2] 增加预算至 $230/月
[3] 切换到更便宜的 models (Haiku)
[4] 启用成本优化
```

## 成本预测

```
User: /cost --forecast

Claude Code: 成本预测
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

基于您的使用模式：

未来 7 天预测：
├─ 明天 (Thu):     $2.95  (与周三相似)
├─ Fri:                $4.10  (忙碌日模式)
├─ Sat:                $0.50  (周末低)
├─ Sun:                $0.85  (周末低)
├─ Mon:                $2.40  (周初)
├─ Tue:                $3.60  (周中高峰)
└─ Wed:                $2.15  (正常日)
    总计:            $16.55

月底预测：
当前：$58.92
预测：+$62.34
总计：$121.26

预算：$100.00
超支：-$21.26 (超出预算 21%)

季节性模式：
- 工作日：平均 $2.94/天
- 周末：平均 $0.68/天
- 高峰时段：下午 2-4 点（$0.15/小时）

保持在预算内的建议：
- 工作日使用减少 25%
- 简单任务使用 Haiku
- 启用自动优化
```

## 导出成本数据

```
User: /cost --export

Claude Code: 导出成本数据
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

格式：
[1] JSON（机器可读）
[2] CSV（电子表格）
[3] PDF（报告）

时间范围：
[1] 当前会话
[2] 今天
[3] 本周
[4] 本月
[5] 自定义范围

User: 2, 4

正在生成本月报告...

已导出：cost-report-2025-01.csv

文件包含：
- 每日使用分解
- 每个会话详情
- 任务分类
- Model 比较
- 预算跟踪

使用 Excel/Sheets 打开进行分析。
```

## 订阅套餐

```
User: /cost --plans

Claude Code: 订阅套餐比较
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

您的当前套餐：Pay-as-you-go

Pay-as-you-go（当前）：
├─ 成本：可变（基于使用）
├─ 您的平均：$78/月
├─ 速率限制：标准
└─ 功能：全部包含

Claude Pro ($20/月):
├─ 成本：固定 $20/月
├─ 包含：无限消息（合理使用）
├─ 速率限制：更高
├─ 相比您的使用节省：-$58/月（74% 节省）
└─ 功能：优先访问

Team Plan ($30/用户/月):
├─ 成本：每用户固定
├─ 包含：无限 + 协作
├─ 速率限制：最高
└─ 功能：共享 memory、分析

基于您的使用建议：
✓ 切换到 Claude Pro
   每月节省约 $58（74% 节省）
   当前：平均 $78/月
   Pro: $20/月 固定

查看：/usage 了解更多详情
```

## 故障排除

### 意外的高成本

```
User: 为什么我今天的成本这么高？

User: /cost --analyze

Claude Code: 成本分析
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

今天的成本：$12.45
平均：$2.62
差异：+$9.83 (376% 更高)

检测到异常活动：

1. 大文件重构 (14:23-14:56)
   Tokens: 89,234
   成本: $5.67 (45.5%)
   文件: src/generated-api.ts (67k tokens)

2. 多次全代码库搜索
   次数：23 次搜索
   Tokens: 34,567
   成本: $3.45 (27.7%)

3. 大量代码生成
   生成：2,345 行代码
   Tokens: 28,901
   成本: $2.89 (23.2%)

建议：
- 从 context 中排除生成的文件
- 批量处理类似搜索
- 使用更有针对性的文件读取
- 在大型操作之间考虑 /compact

估计节省：$8.23 (66%)
```

## 最佳实践

### 成本高效使用

```
✓ 定期使用 /compact（减少 context 成本）
✓ 为任务选择适当的 model
✓ 从 context 中删除未使用的文件
✓ 批量处理类似操作
✓ 使用 /cost --watch 监控
✓ 设置预算警报
✓ 导出数据进行分析

✗ 在 context 中保留大型生成文件
✗ 简单任务使用 Opus
✗ 让 context 无节制增长
✗ 忽略成本警告
```

## 相关命令

- `/context` - 监控 token 使用
- `/usage` - 检查订阅限制
- `/compact` - 减少 context（节省成本）
- `/model` - 切换 models 以提高成本效率

## 提示

- 会话结束时检查 `/cost`
- 设置每日/每月预算
- 简单任务使用 Haiku（便宜 95%）
- 定期压缩 context（节省 50-70%）
- 对昂贵操作使用 `/cost --watch` 监控
- 每月导出数据进行跟踪
- 启用成本优化功能

## 常见问题

**问：每条消息都要花钱吗？**
答：是的，输入（您的消息 + context）和输出（Claude 的响应）都会消耗 tokens。

**问：哪个 model 最便宜？**
答：Haiku 最便宜（$0.25/$1.25 每 1M tokens），然后是 Sonnet ($3/$30)，然后是 Opus ($15/$75)。

**问：如何降低成本？**
答：使用 `/compact`、简单任务切换到 Haiku、删除未使用的文件、批量操作。

**问：token 计数包括什么？**
答：您的消息、Claude 的响应、文件内容、系统 prompts 和 CLAUDE.md memory。

**问：失败的命令会消耗 tokens 吗？**
答：会的，输入和任何部分输出都会计算。

**问：有免费套餐吗？**
答：没有免费套餐，但 Claude Pro（$20/月）为重度用户提供更好的价值。

**问：成本估算有多准确？**
答：非常准确（99%+），基于实际的 token 计数。
