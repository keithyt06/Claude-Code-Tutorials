# `/usage` 命令示例

## 概述
`/usage` 命令显示订阅套餐的使用限制和速率限制状态，帮助您了解当前使用情况与分配限制的对比。

## 何时使用
- 检查剩余使用配额
- 了解速率限制
- 监控订阅套餐限制
- 规划大量使用会话
- 排查速率限制错误
- 比较套餐选项

## 示例用法

### 场景 1：查看使用情况（订阅套餐）

```
User: /usage

Claude Code: 使用情况 & 限制
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

套餐：Claude Pro
账户：user@example.com

每月使用：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

消息数：1,234 / 无限制
状态：🟢 无限制

使用级别：正常
▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

速率限制：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

每分钟请求数：45 / 50 (90%)
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░

每日消息数：856 / 1000 (85.6%)
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░

重置时间：4h 23m

订阅：
├─ 套餐：Claude Pro ($20/月)
├─ 下次计费：2025-02-01
├─ 剩余天数：23
└─ 状态：活跃 ✓

使用情况与套餐限制对比：
🟢 完全在限制内
无需采取行动
```

### 场景 2：接近限制

```
User: /usage

Claude Code: 使用情况 & 限制
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

套餐：Claude Pro
账户：user@example.com

⚠️  警告：接近每日限制

今日消息数：947 / 1000 (94.7%)
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░

剩余：53 条消息
预计达到限制时间：~2 小时（按当前速度）

速率限制：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

每分钟请求数：48 / 50 (96%)
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░
状态：⚠️  接近限制

当前速率：47 请求/分钟
减速至：建议 <40 请求/分钟

建议：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1] 间隔开请求（添加延迟）
[2] 减少消息频率
[3] 等待每日重置（4h 12m）
[4] 谨慎继续（可能达到限制）

每日限制重置：2025-01-09 00:00 (4h 12m)
```

### 场景 3：速率受限

```
User: 帮我处理另一个任务

Claude Code: ⛔ 达到速率限制
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

您已达到速率限制：
每分钟 50 个请求（Pro 套餐）

当前速率：52 请求/分钟
超出：2 个请求

请等待：45 秒

速率限制详情：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

限制：50 请求/分钟
已用：50 个请求（最近 60 秒）
重置时间：45 秒

您最近的请求：
19:45:12 - 请求
19:45:15 - 请求
19:45:17 - 请求
19:45:19 - 请求
[... 最近一分钟内还有 46 个请求 ...]

避免速率限制：
- 在请求之间添加 2-3 秒延迟
- 使用 /compact 减少 context（更快响应）
- 批量处理类似操作
- 大量操作前检查 /usage

45 秒后自动重试？(y/n)
```

## 按需付费使用

```
User: /usage

Claude Code: API 使用情况
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

套餐：按需付费
账户：user@example.com

注意：按需付费无使用限制
您按使用的 token 付费。参见 /cost 了解定价。

速率限制：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

每分钟请求数：35 / 60 (58%)
▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░
状态：🟢 健康

每分钟 tokens: 12,456 / 40,000 (31%)
▓▓▓▓▓▓░░░░░░░░░░░░░░
状态：🟢 健康

当前会话：
├─ 持续时间：1h 23m
├─ 使用 tokens: 45,234
├─ 成本：$0.87
└─ 平均：542 tokens/分钟

使用提示：
- 无消息限制（无限制）
- 按 token 使用计费
- 查看成本：/cost
- 设置预算：/cost --budget [金额]
```

## 套餐对比

```
User: /usage --compare

Claude Code: 套餐对比
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

您当前的使用模式：

平均使用：
├─ 每日消息数：856
├─ 每日 tokens: 234,567
└─ 预计成本：$4.52/天

按需付费（当前）：
┌────────────────────────────────────────────────────────┐
│ 成本：~$135/月（基于您的使用）                         │
│ 限制：无（按使用付费）                                 │
│ 速率：60 请求/分钟                                     │
│ 最适合：使用量波动                                     │
└────────────────────────────────────────────────────────┘

Claude Pro ($20/月)：
┌────────────────────────────────────────────────────────┐
│ 成本：固定 $20/月                                      │
│ 消息数：无限制（公平使用）                             │
│ 限制：~1000 消息/天                                    │
│ 速率：50 请求/分钟                                     │
│ 最适合：定期大量使用                                   │
│                                                         │
│ 您的匹配度：✓ 优秀（每月节省 $115）                   │
│ 节省：对您的使用便宜 85%                               │
└────────────────────────────────────────────────────────┘

Claude Team ($30/用户/月)：
┌────────────────────────────────────────────────────────┐
│ 成本：$30/用户/月                                      │
│ 消息数：无限制（更高限制）                             │
│ 限制：~2000 消息/天                                    │
│ 速率：80 请求/分钟                                     │
│ 功能：协作，共享内存                                   │
│ 最适合：团队使用                                       │
└────────────────────────────────────────────────────────┘

建议：
✓ 切换到 Claude Pro
  每月节省 ~$115（85% 节省）
  完全在使用限制内
  更高速率限制

升级：https://claude.ai/upgrade
```

## 使用历史

```
User: /usage --history

Claude Code: 使用历史
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

套餐：Claude Pro
期间：2025 年 1 月

每日使用：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1月01日：234 消息  ▓▓▓▓▓░░░░░ (23%)
1月02日：456 消息  ▓▓▓▓▓▓▓▓▓░ (46%)
1月03日：678 消息  ▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░ (68%)
1月04日：890 消息  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░ (89%)
1月05日：923 消息  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░ (92%)
1月06日：456 消息  ▓▓▓▓▓▓▓▓▓░ (46%)
1月07日：234 消息  ▓▓▓▓▓░░░░░ (23%)
1月08日：947 消息  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░ (95%) ⚠️

平均：602 消息/天
峰值日：1月08日（947 消息）
最低日：1月01日（234 消息）

每周模式：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

周一：756 平均  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░
周二：834 平均  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
周三：678 平均  ▓▓▓▓▓▓▓▓▓▓▓▓▓░░
周四：890 平均  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
周五：923 平均  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
周六：234 平均  ▓▓▓▓▓░░░░░░░░░░
周日：345 平均  ▓▓▓▓▓▓▓░░░░░░░░

最繁忙时段：下午 2-4 点（145 消息/小时）
最安静时段：晚上 11 点-早上 6 点（12 消息/小时）

速率限制事件：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1月04日, 14:23 - 速率受限（52/50 每分钟）
1月05日, 15:45 - 速率受限（53/50 每分钟）
1月08日, 16:12 - 速率受限（51/50 每分钟）

总事件：3
建议：高峰时段间隔开请求
```

## 使用警报

```
User: /usage --alert 90

Claude Code: 使用警报配置
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

警报阈值：每日限制的 90%
当前套餐：Claude Pro（1000 消息/天）
警报于：900 消息

警报类型：
[✓] 对话内通知
[✓] 桌面通知
[✓] 电子邮件（如已配置）

您将在以下情况下收到通知：
- 每日使用达到 900 消息（90%）
- 接近速率限制（>45/50 每分钟）
- 检测到异常使用激增

✓ 警报已配置

[稍后，达到阈值时]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔔 使用警报：达到 90% 阈值

今日消息数：912 / 1000 (91.2%)
剩余：88 消息
重置时间：3h 45m

当前速度：47 消息/小时
预计达到限制：~1h 52m

建议：
- 减少消息频率
- 使用 /compact 减少响应长度
- 如不紧急则等待每日重置
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 速率限制详情

```
User: /usage --rate-limits

Claude Code: 速率限制详情
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

套餐：Claude Pro

速率限制：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

每分钟：
├─ 限制：50 请求/分钟
├─ 当前：23 请求/分钟（46%）
├─ 可用：27 个请求
└─ 重置：每 60 秒（滚动窗口）

每小时：
├─ 限制：2000 请求/小时
├─ 当前：456 请求/小时（22.8%）
├─ 可用：1544 个请求
└─ 重置：每小时整点

每日：
├─ 限制：1000 消息/天
├─ 当前：947 消息（94.7%）
├─ 可用：53 消息
└─ 重置：UTC 午夜（3h 45m）

Token 速率限制：
├─ 输入：100,000 tokens/分钟
├─ 输出：40,000 tokens/分钟
├─ 当前输入：12,456/分钟（12%）
├─ 当前输出：8,234/分钟（21%）
└─ 状态：🟢 健康

当前请求模式：
最近 60 秒：23 个请求
最近 5 分钟：87 个请求（平均 17.4/分钟）
最近 1 小时：456 个请求（平均 7.6/分钟）

状态：🟢 在所有限制内
```

## 使用优化

```
User: /usage --optimize

Claude Code: 使用优化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

分析您的使用模式...

当前使用：
├─ 消息数/天：602 平均
├─ 峰值使用：947 消息（1月08日）
└─ 速率限制命中：本周 3 次

优化机会：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 减少快速连续请求
   检测到：60 秒内 52 个请求（3 次）
   建议：请求之间添加 2 秒延迟
   好处：避免速率限制

2. 更频繁使用 /compact
   平均 context: 145,234 tokens
   高 context 下响应更慢
   建议：在 100k tokens 时压缩
   好处：更快响应，更少速率限制命中

3. 批量处理类似操作
   检测到：15 次单独文件读取
   可批量处理：3 次操作
   好处：减少请求数 80%

4. 安排大量操作
   峰值使用：下午 2-4 点（145 消息/小时）
   建议：分散到非高峰时段
   好处：全天使用更平滑

5. 使用适当的 models
   对简单任务使用 Sonnet：23% 的消息
   建议：对简单任务切换到 Haiku
   好处：更快响应，更少配额使用

应用优化：
[1] 启用自动请求节奏控制
[2] 在 100k tokens 时自动压缩
[3] 批量文件操作
[4] 以上全部

User: 4

✓ 优化已启用
预期改进：减少 40% 速率限制，使用更平滑
```

## 团队使用（团队套餐）

```
User: /usage --team

Claude Code: 团队使用概览
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

套餐：Claude Team
组织：TechCorp Inc.
席位：5 / 10 已使用

团队使用（2025 年 1 月）：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

总消息数：4,523
每用户平均：905 消息

按用户：
┌────────────────────┬──────────┬────────────┬──────────┐
│ 用户               │ 消息数   │ 占总数 %   │ 状态     │
├────────────────────┼──────────┼────────────┼──────────┤
│ alice@techcorp.com │ 1,234    │ 27.3%      │ 🟢       │
│ bob@techcorp.com   │ 1,123    │ 24.8%      │ 🟢       │
│ carol@techcorp.com │ 945      │ 20.9%      │ 🟢       │
│ david@techcorp.com │ 876      │ 19.4%      │ 🟢       │
│ eve@techcorp.com   │ 345      │ 7.6%       │ 🟢       │
└────────────────────┴──────────┴────────────┴──────────┘

速率限制（团队）：
├─ 每用户：80 请求/分钟
├─ 团队总计：400 请求/分钟
├─ 当前团队：156 请求/分钟（39%）
└─ 状态：🟢 健康

团队统计：
├─ 最活跃日：1月05日（678 消息）
├─ 最不活跃日：1月07日（123 消息）
├─ 峰值时段：下午 2-3 点（234 消息）
└─ 平均会话：1h 45m

可用席位：5
添加用户：https://claude.ai/team/invite
```

## 订阅管理

```
User: /usage --subscription

Claude Code: 订阅详情
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

当前套餐：Claude Pro
账户：user@example.com

计费：
├─ 费用：$20.00/月
├─ 下次计费：2025-02-01
├─ 付款方式：•••• 4242
└─ 状态：活跃 ✓

套餐功能：
✓ 无限消息（公平使用 ~1000/天）
✓ 高流量期间优先访问
✓ 扩展 context 窗口（200K tokens）
✓ 更高速率限制（50 请求/分钟）
✓ 新功能早期访问

本期使用：
├─ 开始：2025-01-01
├─ 已过天数：8 / 31
├─ 消息数：4,816
├─ 平均：602 消息/天
└─ 状态：正常使用 ✓

与限制对比：
🟢 完全在公平使用准则内

管理订阅：
[1] 查看发票
[2] 更新付款方式
[3] 更改套餐
[4] 取消订阅

管理地址：https://claude.ai/account
```

## 故障排除

### 超出限制

```
User: [尝试发送消息]

Claude Code: ⛔ 达到每日限制
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

您已达到每日消息限制：
1000 消息（Claude Pro）

今日已用：1000 / 1000 (100%)
重置时间：2h 45m（UTC 00:00）

选项：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1] 等待重置（2h 45m）
    您的限制在 UTC 午夜重置

[2] 升级到 Team 套餐
    更高限制：2000 消息/天
    费用：$30/月

[3] 切换到按需付费
    无每日限制（按 token 付费）
    您最近的使用：~$4.50/天

[4] 审查使用模式
    查看最常达到限制的时间
    优化使用时机

避免达到限制：
- 全天分散使用
- 使用 /compact 减少消息长度
- 启用使用警报（/usage --alert 80）
```

### 检测到异常使用

```
Claude Code: 🔔 异常使用警报
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

检测到您账户上的异常活动：

今日使用：2,456 消息
平均使用：602 消息
差异：+1,854 消息（增加 308%）

活动时间线：
14:00-15:00: 856 消息（⚠️ 正常的 14 倍）
15:00-16:00: 923 消息（⚠️ 正常的 15 倍）
16:00-17:00: 677 消息（⚠️ 正常的 11 倍）

这可能表明：
- 自动化脚本或 bot
- API 集成问题
- 共享账户使用
- 无意的快速请求

为保护您：
⚠️  已应用临时速率限制
当前限制：20 请求/分钟（从 50 降低）

恢复正常限制：
[1] 确认这是预期使用
[2] 审查最近活动
[3] 如未授权则联系支持

审查活动：/usage --detailed --date today
```

## 最佳实践

### 高效使用

```
✓ 定期监控使用（/usage）
✓ 达到限制前设置警报
✓ 间隔开请求（2-3 秒）
✓ 使用 /compact 减少 context
✓ 批量操作前检查限制
✓ 非高峰时段优化
✓ 每月审查使用模式

✗ 不要快速连续请求
✗ 不要忽略使用警告
✗ 不要等到达到限制
✗ 不要使用没有节奏控制的自动化脚本
```

### 套餐选择

```
选择按需付费如果：
- 使用量变化很大
- 平均 <500 消息/天
- 轻度使用注重成本

选择 Claude Pro 如果：
- 定期每日使用
- 平均 500-1000 消息/天
- 希望可预测的成本
- 需要优先访问

选择 Team 如果：
- 多个用户
- 需要协作功能
- 每用户平均 >1000 消息/天
- 需要管理员控制
```

## 相关命令

- `/cost` - 查看 token 成本和支出
- `/context` - 监控 token 使用
- `/status` - 检查账户状态
- `/model` - 切换 models（影响速率）

## 提示

- 如果接近限制每天检查 `/usage`
- 在 80% 阈值设置警报
- 定期使用 `/compact` 保持在速率限制下
- 每月导出使用数据进行分析
- 审查模式以优化时机
- 如果频繁达到限制考虑升级套餐
- 启用自动优化功能

## 常见问题

**问：什么计入我的每日限制？**
答：每次来回消息计为 1 次，无论长度（在合理范围内）。

**问：失败的消息计数吗？**
答：不，只有成功的消息交换计数。

**问：可以结转未使用的消息吗？**
答：不可以，限制在 UTC 午夜每日重置。

**问：如果达到限制会怎样？**
答：您需要等待每日重置或升级套餐。

**问：速率限制是按账户还是按设备？**
答：按账户，跨所有设备。

**问：工具调用计为消息吗？**
答：不，只有对话消息计入每日限制。

**问：可以请求增加限制吗？**
答：升级到 Team 套餐获得更高限制，或使用按需付费获得无限制。
