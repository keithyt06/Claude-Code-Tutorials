# `/context` 命令示例

## 概述
`/context` 命令将您当前的 context 窗口使用情况可视化为彩色网格，显示对话、代码和其他数据使用了 Claude 可用 context 的多少。

## 何时使用
- 检查已使用多少 context
- 了解何时使用 `/compact` 或 `/clear`
- 添加大文件前监控 context
- 规划长对话
- 调试 context 相关问题
- 优化 token 使用

## 示例用法

### 场景 1：基本 Context 可视化

```
User: /context

Claude Code: Context 窗口可视化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Model: Claude Sonnet 4.5
Context 窗口：200,000 tokens

当前使用：35,420 tokens (17.7%)

视觉表示：
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

图例：
▓ 已使用 (35,420 tokens)
░ 可用 (164,580 tokens)

分解：
├─ 对话历史：        18,234 tokens (51.5%)
├─ 代码 context:     12,456 tokens (35.2%)
├─ CLAUDE.md memory:  3,210 tokens (9.1%)
├─ 系统 prompts:      1,520 tokens (4.3%)
└─ 保留（缓冲）：    10,000 tokens

状态：🟢 健康
建议：无需采取行动
```

### 场景 2：高 Context 使用警告

```
User: /context

Claude Code: Context 窗口可视化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Model: Claude Sonnet 4.5
Context 窗口：200,000 tokens

当前使用：178,500 tokens (89.3%)

视觉表示：
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░

图例：
▓ 已使用 (178,500 tokens)
░ 可用 (21,500 tokens)

分解：
├─ 对话历史：      89,234 tokens (50.0%)
├─ 代码 context:   67,456 tokens (37.8%)
├─ 文件内容：      18,210 tokens (10.2%)
├─ CLAUDE.md memory: 2,100 tokens (1.2%)
└─ 系统 prompts:    1,500 tokens (0.8%)

状态：🔴 严重
警告：Context 几乎已满！

建议：
[1] 使用 /compact 减少 context
[2] 使用 /clear 重新开始
[3] 删除不必要的文件 contexts
[4] 继续（可能很快达到限制）

User: 1

Claude Code: 正在运行 /compact...
Context 减少到 45,210 tokens (22.6%)
```

### 场景 3：详细 Context 分解

```
User: /context --detailed

Claude Code: 详细 Context 分析
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

总计：35,420 / 200,000 tokens (17.7%)

对话历史：18,234 tokens (51.5%)
┌────────────────────────────────────────┬─────────┐
│ 消息                                   │ Tokens  │
├────────────────────────────────────────┼─────────┤
│ User: "帮我重构..."                    │ 3,456   │
│ Assistant: [重构解释]                  │ 8,921   │
│ User: "添加单元测试..."                │ 2,134   │
│ Assistant: [测试实现]                  │ 3,723   │
└────────────────────────────────────────┴─────────┘

代码 Context: 12,456 tokens (35.2%)
┌────────────────────────────────────────┬─────────┐
│ 文件                                   │ Tokens  │
├────────────────────────────────────────┼─────────┤
│ src/auth/login.ts                      │ 4,234   │
│ src/api/users.ts                       │ 3,456   │
│ src/utils/validation.ts                │ 2,876   │
│ src/components/UserForm.tsx            │ 1,890   │
└────────────────────────────────────────┴─────────┘

CLAUDE.md Memory: 3,210 tokens (9.1%)
├─ 项目概览：1,234 tokens
├─ 编码标准：987 tokens
├─ 架构说明：765 tokens
└─ 常见模式：224 tokens

系统 Prompts: 1,520 tokens (4.3%)
├─ 基础指令：890 tokens
├─ 工具描述：430 tokens
└─ 安全指南：200 tokens

最大贡献者：
1. Assistant 响应（重构）：8,921 tokens
2. src/auth/login.ts: 4,234 tokens
3. User 消息（初始请求）：3,456 tokens

删除大项：/context --remove [项目]
```

## Context 使用模式

### 低使用 (< 25%)

```
Context: 15,420 / 200,000 tokens (7.7%)

▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

状态：🟢 优秀
- 大量 context 可用
- 可以添加更多文件/对话
- 无需优化
```

### 中等使用 (25-75%)

```
Context: 98,420 / 200,000 tokens (49.2%)

▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

状态：🟡 中等
- 约一半容量已使用
- 添加大文件时考虑 /compact
- 对话期间监控使用
```

### 高使用 (75-90%)

```
Context: 168,420 / 200,000 tokens (84.2%)

▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░

状态：🟠 高
警告：接近 context 限制

建议：
- 使用 /compact 减少约 50-70%
- 删除不必要的文件 contexts
- 如果开始新主题考虑 /clear
```

### 严重使用 (> 90%)

```
Context: 188,420 / 200,000 tokens (94.2%)

▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░

状态：🔴 严重
错误：Context 几乎耗尽！

⚠️ 仅剩 11,580 tokens
⚠️ 下次响应可能超出限制

需要采取行动：
[1] /compact（减少约70%，保留 context）
[2] /clear（重新开始，丢失历史）
[3] 继续（有风险，可能失败）

选择选项 (1-3)：
```

## Context 管理

### 删除特定项

```
User: /context --remove src/auth/login.ts

Claude Code: 从 Context 删除
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

文件：src/auth/login.ts
大小：4,234 tokens（当前 context 的 11.9%）

从 context 删除此文件？(y/n)

User: y

Claude Code: ✓ 已删除 src/auth/login.ts

Context 已减少：
之前：35,420 tokens
之后：31,186 tokens
节省：4,234 tokens (11.9%)

新状态：🟢 31,186 / 200,000 (15.6%)
```

### 删除多个项

```
User: /context --cleanup

Claude Code: Context 清理向导
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

正在分析 context 以查找可删除项...

大项（可以安全删除）：
[ ] src/auth/login.ts (4,234 tokens)
[ ] 旧对话（10 条消息，8,921 tokens）
[ ] src/api/legacy-code.ts (3,456 tokens)
[ ] 消息中的构建输出（2,876 tokens）

选择要删除的项（空格切换，回车确认）：

User: [选择前 3 项]

正在删除选定项...

✓ 已删除 3 项
释放：16,611 tokens

Context: 18,809 / 200,000 (9.4%)
状态：🟢 优秀
```

### 优化 Context

```
User: /context --optimize

Claude Code: Context 优化
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

正在分析 context 以查找优化机会...

发现：
1. 重复代码片段（1,234 tokens）
2. 冗余解释（2,456 tokens）
3. 旧错误消息（987 tokens）
4. 未使用的文件 contexts（4,123 tokens）

总节省：8,800 tokens (24.8%)

优化？(y/n)

User: y

正在优化...

✓ 已删除重复项
✓ 已整合解释
✓ 已清理旧消息
✓ 已删除未使用的 contexts

Context 已减少：
之前：35,420 tokens → 之后：26,620 tokens
节省：8,800 tokens (24.8%)

新状态：🟢 26,620 / 200,000 (13.3%)
```

## Context 监控

### 实时监控

```
User: /context --watch

Claude Code: Context 监视器（实时）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

当前：35,420 / 200,000 tokens (17.7%)

▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

每 5 秒更新一次。按 Ctrl+C 停止。

[用户继续对话]

[5 秒后]
当前：38,924 / 200,000 tokens (19.5%)
变化：+3,504 tokens（添加了新消息）

▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░

[继续实时更新]
```

### 设置 Context 警报

```
User: /context --alert 80%

Claude Code: Context 警报已配置
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

警报阈值：80% (160,000 tokens)
当前使用：35,420 tokens (17.7%)

Context 达到 80% 时将通知您。

警报类型：
[✓] 对话内警告
[✓] 桌面通知
[ ] 电子邮件警报

配置：/context --alert-settings

[稍后，达到 80% 时]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⚠️  Context 警报：达到 80% 阈值！

当前：162,340 / 200,000 tokens (81.2%)
剩余：37,660 tokens

建议：即将使用 /compact 或 /clear
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## Context 对比

### 对比会话

```
User: /context --compare

Claude Code: Context 对比
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

当前会话：
35,420 tokens (17.7%)
持续时间：1h 23m
消息数：24

上次会话：
89,234 tokens (44.6%)
持续时间：3h 12m
消息数：67

对比：
- Context 使用减少 60%
- 持续时间缩短 57%
- 消息减少 64%

当前会话更高效！

效率评分：⭐⭐⭐⭐⭐ (5/5)
```

### Model Context 对比

```
User: /context --models

Claude Code: 跨 Models 的 Context
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

您当前的对话：

Sonnet 4.5（当前）：
200,000 tokens 可用
35,420 已使用 (17.7%)
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
状态：🟢 优秀

Opus:
200,000 tokens 可用
35,420 已使用 (17.7%)
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
状态：🟢 优秀

Haiku:
200,000 tokens 可用
35,420 已使用 (17.7%)
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
状态：🟢 优秀

所有 models 都可以轻松处理此对话。
```

## 导出 Context 分析

```
User: /context --export

Claude Code: 导出 Context 分析
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

格式：
[1] JSON（详细分解）
[2] CSV（电子表格）
[3] Markdown（人类可读）
[4] 图表（PNG 视觉）

User: 3

已导出到：context-analysis-2025-01-08.md

# Context 分析报告
日期：2025-01-08 14:45:23

## 摘要
- 总 tokens: 35,420 / 200,000 (17.7%)
- 状态：健康
- Model: Claude Sonnet 4.5

## 分解
| 类别                  | Tokens  | 百分比     |
|-----------------------|---------|------------|
| 对话历史              | 18,234  | 51.5%      |
| 代码 context          | 12,456  | 35.2%      |
| CLAUDE.md memory      | 3,210   | 9.1%       |
| 系统 prompts          | 1,520   | 4.3%       |

[完整报告已保存]
```

## 故障排除

### Context 超出限制

```
User: [提交很长的消息]

Claude Code: ⚠️  Context 限制已超出

您的消息将超出 context 窗口。

当前：188,420 tokens
您的消息：15,234 tokens
总计：203,654 tokens
限制：200,000 tokens
超出：3,654 tokens

选项：
[1] 先压缩对话
[2] 缩短您的消息
[3] 清除 context 并重新开始
[4] 切换到更大的 model（如可用）

User: 1

正在压缩对话...
✓ Context 减少到 48,210 tokens

您现在可以发送消息了。
```

### 意外的高使用

```
User: 为什么我的 context 这么高？

User: /context --analyze

Claude Code: Context 使用分析
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

总计：142,340 tokens (71.2%)

意外大项：

⚠️  加载大文件：src/generated-api.ts
    大小：67,234 tokens（context 的 47%！）
    可能是自动生成的代码

⚠️  长对话线程
    消息：89
    大小：45,123 tokens（context 的 31%）

⚠️  多个文件 contexts
    文件：23
    平均：每个 1,234 tokens

建议：
1. 删除生成的文件：/context --remove src/generated-api.ts
2. 压缩对话：/compact
3. 关闭未使用的文件 contexts

应用建议？(y/n)

User: y

正在优化...
✓ 已删除生成的文件（-67,234 tokens）
✓ 已压缩对话（-30,892 tokens）
✓ 已关闭未使用的文件（-12,456 tokens）

Context: 31,758 / 200,000 (15.9%)
状态：🟢 优秀
```

## 最佳实践

### 1. 定期监控

```
定期检查 context：
- 会话开始：/context
- 添加文件后：/context
- 长操作前：/context
- 感觉"慢"时：/context
```

### 2. 主动管理

```
当 context > 50% 时：
- 审查使用 context 的内容
- 删除不必要的项
- 考虑 /compact

当 context > 75% 时：
- 确实使用 /compact
- 或如果更改主题则 /clear
```

### 3. 高效使用

```
✓ 使用后删除文件
✓ 长对话后压缩
✓ 使用特定文件路径，而不是整个目录
✓ 切换任务时清除 context
✗ 不要在 context 中保留不必要的文件
✗ 不要让 context 无节制增长
```

## 相关命令

- `/compact` - 通过总结减少 context
- `/clear` - 清除所有 context
- `/cost` - 查看 token 成本
- `/usage` - 检查使用限制
- `/export` - 清除前保存对话

## 提示

- 添加大文件前检查 `/context`
- Context > 75% 时使用 `/compact`
- 在 80% 阈值设置警报
- 清除前导出重要对话
- 长会话期间监控 context
- 从 context 删除生成的/大文件
- 使用 `/context --detailed` 查找大项

## 常见问题

**问：达到 context 限制时会发生什么？**
答：Claude Code 将提示您在继续前压缩或清除。

**问：context 影响响应质量吗？**
答：非常高的 context（>90%）可能略微减慢响应，但不影响质量。

**问：可以增加 context 窗口吗？**
答：不可以，它由 model 决定。所有 Sonnet/Opus/Haiku 都有 200K tokens。

**问：`/compact` 会丢失重要信息吗？**
答：不会，它会总结同时保留关键详情。关键信息会保留。

**问：token 计数有多准确？**
答：非常准确（约99%）。基于 Claude 使用的实际 tokenization。

**问：context 在会话间持久存在吗？**
答：不，每个会话重新开始 context（除非导出/导入）。

**问：可以查看历史 context 使用情况吗？**
答：可以，使用 `/context --history` 查看随时间的使用情况。
