# `/bug` 命令示例

## 概述
`/bug` 命令允许您向 Anthropic 报告 bug，通过发送对话 context 和 bug 描述来帮助改进 Claude Code。

## 何时使用
- 遇到意外行为
- 发现可重现的 bug
- 遇到崩溃或错误
- 功能未按文档说明工作
- 性能问题
- 希望在有 context 的情况下报告反馈

## 示例用法

### 基本 Bug 报告

```
User: /bug

Claude Code: 报告 Bug
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

这将向 Anthropic 发送您的对话以供分析。

将分享的内容：
✓ 当前对话历史
✓ 您的 bug 描述
✓ 系统信息
✓ 错误日志（如有）

不会分享的内容：
✗ API keys 或凭据
✗ 文件内容（除非您选择包含）
✗ 个人信息（除非在对话中）

描述 bug：
User: /compact 命令在 context > 150k tokens 时崩溃

重现步骤（可选）：
User: 1. 加载大文件（100k+ tokens）
      2. 进行长对话
      3. 运行 /compact
      4. 崩溃并显示 "out of memory" 错误

预期行为：
User: 应该能够压缩对话而不崩溃

实际行为：
User: 进程退出，错误代码 137

包含当前对话？(y/n)
User: y

包含系统日志？(y/n)
User: y

正在提交 bug 报告...

✓ Bug 报告已提交
✓ 报告 ID: BUG-2025-01-08-1423

感谢您的报告！我们将进行调查，必要时会跟进。

跟踪您的报告：https://github.com/anthropics/claude-code/issues
```

### 带截图的 Bug 报告

```
User: /bug

描述 bug：
User: 状态行显示乱码字符

附加截图？(y/n)
User: y

截图已保存到：/tmp/claude-bug-screenshot.png

在报告中包含截图？(y/n)
User: y

✓ 已附加截图
✓ Bug 报告已提交 (BUG-2025-01-08-1445)
```

### 快速 Bug 报告

```
User: /bug "搜索文件名中包含特殊字符时失败"

Claude Code: 快速 bug 报告已提交！

报告 ID: BUG-2025-01-08-1456
默认包含的信息：
✓ Bug 描述
✓ 系统信息
✓ 最近对话（最后 10 条消息）

在以下位置添加更多详情：
https://github.com/anthropics/claude-code/issues
```

## Bug 报告类别

### 崩溃/错误

```
类型：崩溃
严重程度：高

描述：Claude Code 意外退出
错误：收到 SIGABRT
频率：每次使用 /agents 时

自动包含：
- Stack trace
- 错误日志
- 崩溃前的系统状态
```

### 功能无法工作

```
类型：功能问题
严重程度：中

描述：/vim mode 键绑定无响应
预期：ESC 应退出插入模式
实际：ESC 无作用
环境：macOS 上的 iTerm2
```

### 性能问题

```
类型：性能
严重程度：低

描述：大 context 下响应非常慢
Context 大小：180k tokens
响应时间：30+ 秒
预期：< 5 秒
```

## 包含的内容

### 自动包含

```
Bug 报告包：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

系统信息：
├─ Claude Code 版本：1.2.3
├─ 操作系统：macOS 14.2.1
├─ Node.js: 20.10.0
├─ npm: 10.2.3
└─ 架构：arm64

错误详情（如适用）：
├─ 错误消息
├─ Stack trace
├─ 错误代码
└─ 时间戳

配置（已脱敏）：
├─ 启用的功能
├─ 使用的 Model
├─ 工作目录结构
└─ Hook/MCP server 列表（无凭据）

最近活动：
├─ 最后 10 条命令
├─ 文件操作
└─ 工具使用

注意：凭据和密钥会自动删除
```

### 可选包含

```
选择要包含的内容：

[✓] 完整对话历史
[ ] 文件内容
[ ] 截图
[ ] 自定义日志
[ ] 重现步骤

您可以控制分享的内容！
```

## 隐私与安全

```
隐私保护：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

自动删除：
✓ API keys (ANTHROPIC_API_KEY)
✓ Tokens 和凭据
✓ 密码字符串
✓ 电子邮件地址（可选）
✓ 文件路径（可选）
✓ IP 地址（可选）

发送前您可审查：
- 对话内容
- 系统信息
- 日志文件

您的选择：
- 包含/排除对话
- 包含/排除文件
- 匿名 vs 实名报告
```

## Bug 报告状态

```
User: /bug --status BUG-2025-01-08-1423

Bug 报告状态
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

报告 ID: BUG-2025-01-08-1423
提交时间：2025-01-08 14:23
状态：调查中

时间线：
2025-01-08 14:23 - 已提交
2025-01-08 15:12 - 已确认
2025-01-08 16:45 - 分配给团队
2025-01-09 09:30 - 处理中

评论：
[开发团队] 感谢报告！我们已重现
          该问题并正在修复。
          目标：v1.2.4（下周）

更新：将通过电子邮件通知您
```

## 列出您的报告

```
User: /bug --list

您的 Bug 报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

最近报告：

BUG-2025-01-08-1423 | /compact 崩溃     | 调查中
BUG-2025-01-05-0945 | Vim mode 键绑定   | 已在 v1.2.4 修复
BUG-2024-12-28-1534 | 搜索超时          | 已关闭（重复）

总报告数：3
未解决：1
已解决：2
```

## 反馈（非 Bug）

```
User: /bug --feedback

提交反馈
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

用于：
- 功能请求
- 建议
- 一般反馈
- 问题

对于 bug，请使用：/bug

您的反馈：
User: 如果能有 /prettier 命令
      自动格式化代码就太好了

类别：
[1] 功能请求
[2] 改进
[3] 问题
[4] 其他

User: 1

✓ 反馈已提交 (FEEDBACK-2025-01-08-1456)

感谢您的意见！
为此功能投票：
https://github.com/anthropics/claude-code/discussions
```

## 故障排除

### 报告提交失败

```
错误：Bug 报告提交失败

可能原因：
1. 无互联网连接
2. 无法访问 Anthropic server
3. 报告过大

解决方案：
- 检查 /status
- 稍后重试
- 减少包含的内容
- 本地保存报告：/bug --save-local
```

### 找不到报告 ID

```
User: /bug --list

显示所有已提交报告及其 ID
或检查电子邮件确认
```

## 最佳实践

### 良好的 Bug 报告

```
✓ 清晰的描述
✓ 重现步骤
✓ 预期 vs 实际行为
✓ 包含错误消息
✓ 系统信息（自动）

示例：
"当我在 150k+ tokens 时运行 /compact，
Claude Code 崩溃并显示 OOM 错误。
步骤：1) 加载大文件 2) 对话 3) /compact
预期：成功压缩
实际：进程退出（代码 137）"
```

### 不太好的报告

```
✗ "它不工作"
✗ "compact 有 bug"
✗ 无重现步骤
✗ 缺少 context

请具体详细！
```

## 相关命令

- `/doctor` - 先诊断问题
- `/status` - 检查系统状态
- `/export` - 保存对话用于报告
- `/help` - 获取命令帮助

## 提示

- 报告 bug 前运行 `/doctor`
- 包含错误消息
- 提供重现步骤
- 检查是否已报告
- 详细但简洁
- 包含版本信息（自动）
- 审查要分享的内容

## 常见问题

**问：会回应我的 bug 报告吗？**
答：是的，对于确认的 bug。您将收到电子邮件更新。

**问：bug 多久能修复？**
答：因严重程度而异。严重 bug：数天。轻微：数周。

**问：可以匿名报告吗？**
答：可以，但我们无法跟进或通知您修复情况。

**问：如果不是 bug 但我需要帮助怎么办？**
答：先使用 `/help` 或查看文档。

**问：可以附加文件吗？**
答：可以，可以附加截图和日志。

**问：我的代码/数据是私密的吗？**
答：您可以控制包含的内容。敏感数据会自动删除。
